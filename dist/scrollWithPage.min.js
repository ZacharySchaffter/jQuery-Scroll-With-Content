$.fn.scrollWithPage=function(t,e){var i=$(this),o=$(this).closest(t),h=e?$(e):null;if(console.log(o),console.log(i),console.log(h),!o)throw"Container element wasn't found";if(0<i.length){var s={element:i,container:{element:o,height:o.outerHeight(),bottom:o.outerHeight()+o.offset().top},offsetEl:{element:h||null,height:h?h.outerHeight():0},origOffset:i.parent().offset().top,currentPos:i.position().top,height:i.outerHeight(!0),width:i.parent().width(),top:i.offset().top,bottom:Math.ceil(i.offset().top+i.outerHeight(!0)),distanceScrolled:$(window).scrollTop(),scrollDir:!1,viewport:{height:window.innerHeight,bottom:window.innerHeight},changePos:function(t,e,i,o){this.element.css({position:t,top:e,bottom:i}),o?this.element.css({width:o+"px"}):this.element.css({width:"auto"})},update:function(){var t=this,e=t.element,i=t.container.element;this.origOffset=e.parent().offset().top,this.currentPos=e.position().top,this.height=e.outerHeight(!0),this.width=e.parent().width(),this.top=e.offset().top,this.bottom=Math.ceil(e.offset().top+e.outerHeight(!0));var o=$(this.container.element).outerHeight();this.container.heightWithMargin=$(this.container.element).outerHeight(!0),this.container.height=o,this.container.bottom=o+i.offset().top,this.offsetEl.height=this.offsetEl.element?this.offsetEl.element.outerHeight():0,this.lastDistanceScrolled=this.distanceScrolled,this.distanceScrolled=$(window).scrollTop(),this.scrollDir=0<this.distanceScrolled-this.lastDistanceScrolled?"down":"up";var h=window.innerHeight;this.viewport.height=h,this.viewport.bottom=h+this.distanceScrolled;var s=this.distanceScrolled>this.top-this.offsetEl.height?Math.floor(this.distanceScrolled-this.top):0,n=this.distanceScrolled+this.height-s+this.offsetEl.height>=this.container.bottom,l=this.distanceScrolled>this.origOffset-this.offsetEl.height,r=this.height>this.viewport.height-this.offsetEl.height,c=this.height>=this.container.height;this.container.heightWithMargin<this.height&&this.container.element.css("minHeight",this.height+"px"),l?n?(console.log("Reached the bottom"),this.changePos("absolute",this.container.height-this.height,"auto",this.width)):l&&!n&&(console.log("Purgatory"),c?this.changePos("relative","auto","auto"):r?r&&(this.distanceScrolled<=this.top&&"up"===this.scrollDir?this.changePos("fixed",0,"auto",this.width):this.viewport.bottom>=this.bottom&&"down"===this.scrollDir?this.changePos("fixed","auto",0,this.width):this.changePos("absolute",this.top-this.origOffset,"auto",this.width)):this.changePos("fixed",this.offsetEl.height,"auto",t.width)):(console.log("Hasnt scrolled past links"),this.changePos("relative","auto","auto"))}};s&&($(window).scroll(function(){console.log("Scrolled"),s.update()}),$(document).ready(function(){console.log("Loaded"),s.update()}),$(window).resize(function(){console.log("Resized"),s.update()}),$("a[href^='#']").click(function(){setTimeout(function(){s.update()},100)}))}};